!function(a,b,c){"function"==typeof define&&define.amd&&define("keen",[],function(){return c()}),"object"==typeof module&&"object"==typeof module.exports?module.exports=c():b[a]=c()}("Keen",this,function(Keen){"use strict";function Keen(a){a||Keen.log("Check out our JavaScript SDK Usage Guide: https://github.com/keenlabs/keen-js/tree/master/docs"),a.projectId||Keen.log("Please provide a projectId"),Keen.canXHR||"xhr"!==a.requestType||(a.requestType="jsonp"),a.host&&a.host.replace(/.*?:\/\//g,""),a.protocol&&"auto"===a.protocol&&(a.protocol=location.protocol.replace(/:/g,"")),this.config={projectId:a.projectId,writeKey:a.writeKey,readKey:a.readKey,masterKey:a.masterKey,requestType:a.requestType||"jsonp",host:a.host||"api.keen.io/3.0",protocol:a.protocol||"https",globalProperties:null},this.trigger("ready"),Keen.trigger("client",this,a)}function _once(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}function _each(a,b,c){var d;if(!a)return 0;if(c=c?c:a,a instanceof Array){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function _extend(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])a[c]=arguments[b][c];return a}function _parseParams(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1];b=e.exec(g);)c[f(b[1])]=f(b[2]);return c}function _sendBeacon(a,b,c,d){var e=c,f=d,g=!1,h=document.createElement("img");c=null,d=null,h.onload=function(){if(g=!0,"naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();e&&(e({created:!0}),e=f=null)},h.onerror=function(){g=!0,f&&(f(),e=f=null)},h.src=a+"&c=clv1"}function _sendJsonp(a,b,c,d){var e=(new Date).getTime(),f=c,g=d,h=document.createElement("script"),i=document.getElementsByTagName("head")[0],j="keenJSONPCallback",k="keen-jsonp",l=!1;for(c=null,d=null,j+=e,k+=e;j in window;)j+="a";window[j]=function(a){l=!0,f&&a&&f(a),i.removeChild(h),delete window[j],f=g=null},h.id=k,h.src=a+"&jsonp="+j,i.appendChild(h),h.onreadystatechange=function(){l===!1&&"loaded"===this.readyState&&(l=!0,g&&(g(),f=g=null))},h.onerror=function(){l===!1&&(l=!0,g&&(g(),f=g=null))}}function _sendXhr(a,b,c,d,e,f){var g,h,i=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],j=e,k=f;if(e=null,f=null,window.XMLHttpRequest)h=new XMLHttpRequest;else for(var l=0;l<i.length;l++)try{h=new ActiveXObject(i[l]);break}catch(m){}h.onreadystatechange=function(){var a;if(4==h.readyState)if(h.status>=200&&h.status<300){try{a=JSON.parse(h.responseText)}catch(b){Keen.log("Could not parse HTTP response: "+h.responseText),k&&(k(h,b),j=k=null)}j&&a&&(j(a),j=k=null)}else Keen.log("HTTP request failed."),k&&(k(h,null),j=k=null)},h.open(a,b,!0),_each(c,function(a,b){h.setRequestHeader(b,a)}),d&&(g=JSON.stringify(d)),a&&"GET"===a.toUpperCase()?h.send():a&&"POST"===a.toUpperCase()&&h.send(g)}function _uploadEvent(a,b,c,d){var e=this.url("/projects/"+this.projectId()+"/events/"+a),f="",g=this.config.requestType,h={};return this.config.globalProperties&&(h=this.config.globalProperties(a)),_each(b,function(a,b){h[b]=a}),"xhr"!==g&&(f+="?api_key="+encodeURIComponent(this.writeKey()),f+="&data="+encodeURIComponent(Keen.Base64.encode(JSON.stringify(h))),f+="&modified="+encodeURIComponent((new Date).getTime()),String(e+f).length<Keen.urlMaxLength)?void("jsonp"===g?_sendJsonp(e+f,null,c,d):_sendBeacon(e+f,null,c,d)):void(Keen.canXHR?_sendXhr("POST",e,{Authorization:this.writeKey(),"Content-Type":"application/json"},h,c,d):Keen.log("Event not sent: URL length exceeds current browser limit, and XHR (POST) is not supported."))}function _getTimezoneOffset(){return-60*(new Date).getTimezoneOffset()}function _getQueryString(a){var b=[];for(var c in a)if(a[c]){var d=a[c];"[object String]"!==Object.prototype.toString.call(d)&&(d=JSON.stringify(d)),d=encodeURIComponent(d),b.push(c+"="+d)}return"&"+b.join("&")}function _sendQuery(a,b,c,d){var e=a,f="",g=this.config.requestType,h=c,i=d;return c=null,d=null,e.indexOf("extraction")>-1&&(g="xhr"),f+="?api_key="+this.readKey(),f+=_getQueryString.call(this,b),"xhr"!==g&&String(e+f).length<Keen.urlMaxLength?void _sendJsonp(e+f,null,h,i):(Keen.canXHR?_sendXhr("GET",e+f,null,null,h,i):Keen.log("Event not sent: URL length exceeds current browser limit, and XHR (POST) is not supported."),void(h=i=null))}function _select(a){var b,c,d=this,e=a||{},f=[],g=[];""!==e.records&&e.records?(c=e.records.split(Keen.Dataset.defaults.delimeter),b=parse.apply(d,[d.input()].concat(c))[0]):b=[d.input()],each(e.select,function(a){f.push(a.path.split(Keen.Dataset.defaults.delimeter))}),0==f.length&&each(b,function(a){var b=flatten(a);for(var c in b)b.hasOwnProperty(c)&&-1==g.indexOf(c)&&(g.push(c),f.push([c]))});var h=[[]];return each(f,function(a){1==f.length?h[0].push("label","value"):h[0].push(a.join("."))}),each(b,function(a,b){var c=flatten(a);1==f.length?h.push([f.join("."),c[f.join(".")]]):(h.push([]),each(f,function(a){var d=a.join(".");h[b+1].push(c[d])}))}),d.output(h),d.format(e.select),d}function _unpack(a){var b=this,c=[],d=a.unpack.value?a.unpack.value.path.split(Keen.Dataset.defaults.delimeter):!1,e=a.unpack.label?a.unpack.label.path.split(Keen.Dataset.defaults.delimeter):!1,f=a.unpack.index?a.unpack.index.path.split(Keen.Dataset.defaults.delimeter):!1,g=""!==d[d.length-1]?d[d.length-1]:"Value",h=""!==e[e.length-1]?e[e.length-1]:"Label",i=""!==f[f.length-1]?f[f.length-1]:"Index",j=function(){var c;return c=""==a.records?[b.input()]:parse.apply(b,[b.input()].concat(a.records.split(Keen.Dataset.defaults.delimeter))),c[0]}();return j instanceof Array==0&&(j=[j]),each(j,function(a){var d=e?parse.apply(b,[a].concat(e)):[];d&&(c=d)}),each(j,function(a,e){var k=d?parse.apply(b,[a].concat(d)):!1,l=f?parse.apply(b,[a].concat(f)):!1;l?each(l,function(){b.data.output.push([])}):b.data.output.push([]),l&&(0==e&&(b.data.output[0].push(i),c.length>0?each(c,function(a){b.data.output[0].push(a)}):b.data.output[0].push(g)),j.length<b.data.output.length-1?0==e&&each(b.data.output,function(a,c){c>0&&b.data.output[c].push(l[c-1])}):b.data.output[e+1].push(l[0])),!l&&c.length>0&&(0==e&&(b.data.output[0].push(h),b.data.output[0].push(g)),b.data.output[e+1].push(c[0])),l||0!=c.length||b.data.output[0].push(""),k?j.length<b.data.output.length-1?0==e&&each(b.data.output,function(a,c){c>0&&b.data.output[c].push(k[c-1])}):each(k,function(a){b.data.output[e+1].push(a)}):each(b.data.output[0],function(a,c){var d=l?0:-1;c>d&&b.data.output[e+1].push(null)})}),b.format(a.unpack),this}function _optHash(a){return each(a.unpack,function(b,c){b&&is(b,"string")&&(a.unpack[c]={path:a.unpack[c]})}),a}function parse(){var a=[],b=function(){var c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=d.pop();return 0===d.length&&(c instanceof Array?d=c:"object"==typeof c&&d.push(c)),each(d,function(f){if(""==e&&("number"==typeof f||null==f))return a.push(f);if(f[e]||0===f[e]||void 0!==f[e])return a.push(null===f[e]?null:f[e]);if(!c[f]){if("object"!=typeof c||c instanceof Array!=!1||c[e])return b.apply(this,[f].concat(d.splice(1)).concat(e));throw new Error("Target property does not exist",e)}return c[f]instanceof Array?void each(c[f],function(a,g){var h=[c[f]].concat(c[f][g]).concat(d.slice(1)).concat(e);return b.apply(this,h)}):c[f][e]?a.push(c[f][e]):b.apply(this,[c[f]].concat(d.splice(1)).concat(e))}),a.length>0?a:void 0};return b.apply(this,arguments)}function flatten(a){var b={};for(var c in a)if(a.hasOwnProperty(c))if("object"==typeof a[c]&&null!==a[c]){var d=flatten(a[c]);for(var e in d)d.hasOwnProperty(e)&&(b[c+"."+e]=d[e])}else b[c]=a[c];return b}function is(a,b){return a=typeof a,b?a==b:"undefined"!=a}function each(a,b,c){var d;if(!a)return 0;if(c=c?c:a,is(a.length)){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function extend(a,b){return each(b,function(b,c){is(a[c],"object")&&is(b,"object")?a[c]=extend(a[c],b):null!==b&&(a[c]=b)}),a}function _applyFormat(a,b){var c=a,d=b||{};return d.replace&&each(d.replace,function(a,b){(c==b||String(c)==String(b)||parseFloat(c)==parseFloat(b))&&(c=a)}),d.type&&"date"==d.type&&(c=d.format&&moment&&moment(a).isValid()?moment(c).format(d.format):new Date(c)),d.type&&"string"==d.type&&(c=String(c)),d.type&&"number"==d.type&&!isNaN(parseFloat(c))&&(c=parseFloat(c)),c}function _applyPostProcessing(){this.call(_runLabelMapping).call(_runLabelReplacement).call(_runSortGroups).call(_runSortIntervals).call(_runColorMapping)}function _getAdapterActions(){var a=_extend({},Keen.Dataviz.dataTypeMap),b=this.dataType(),c=this.library(),d=this.chartType()||this.defaultChartType();return!c&&a[b]&&(c=a[b].library),c&&!d&&b&&(d=Keen.Dataviz.libraries[c]._defaults[b][0]),c&&!d&&a[b]&&(d=a[b].chartType),c&&d?Keen.Dataviz.libraries[c][d]:{}}function _runColorMapping(){var a=this,b=this.dataset.schema,c=this.dataset.output(),d=this.view.defaults.colors.slice(),e=this.colorMapping(),f=this.dataType()||"";e&&(f.indexOf("chronological")>-1||b.unpack&&c[0].length>2?_each(c[0].slice(1),function(a,b){var c=e[a];c&&d[b]!==c&&d.splice(b,0,c)}):_each(a.dataset.selectColumn(0).slice(1),function(a,b){var c=e[a];c&&d[b]!==c&&d.splice(b,0,c)}),a.view.attributes.colors=d)}function _runIndexBy(){var a=this,b=this.dataset.meta.schema||this.dataset.meta.unpack,c=this.indexBy().split(".").join(Keen.Dataset.defaults.delimeter);each(b,function(b,d){"select"===d&&b instanceof Array?each(b,function(b,e){b.path.indexOf("timeframe -> ")>-1&&(a.dataset.meta.schema[d][e].path=c)}):"unpack"===d&&"object"==typeof b&&(a.dataset.meta.schema[d].index.path=c)}),this.dataset.parse()}function _runLabelMapping(){var a=this,b=this.labelMapping(),c=this.dataset.schema()||{},d=this.dataType()||"";b&&(d.indexOf("chronological")>-1||c.unpack&&a.dataset.output()[0].length>2?each(a.dataset.output()[0],function(c,d){d>0&&(a.dataset.data.output[0][d]=b[c]||c)}):c.select&&2===a.dataset.output()[0].length&&a.dataset.updateColumn(0,function(a){return b[a[0]]||a[0]}))}function _runLabelReplacement(){var a=this,b=this.labels()||null,c=this.dataset.schema()||{},d=this.dataset.output(),e=this.dataType()||"";b&&(e.indexOf("chronological")>-1||c.unpack&&d[0].length>2?_each(d[0],function(c,d){d>0&&b[d-1]&&(a.dataset.data.output[0][d]=b[d-1])}):_each(d,function(c,d){d>0&&b[d-1]&&(a.dataset.data.output[d][0]=b[d-1])}))}function _parseRawData(a){var b,c,d,e,f,g,h,i=this,j={};if(b=i.indexBy()?i.indexBy():Keen.Dataviz.defaults.indexBy,c=Keen.Dataset.defaults.delimeter,d=b.split(".").join(c),e=i.labels()||null,f=i.labelMapping()||null,"number"==typeof a.result&&(g="singular",j={records:"",select:[{path:"result",type:"string",label:"Metric"}]}),a.result instanceof Array&&a.result.length>0){if(!a.result[0].timeframe||"number"!=typeof a.result[0].value&&null!=a.result[0].value||(g="chronological",j={records:"result",select:[{path:d,type:"date"},{path:"value",type:"number"}]}),"number"==typeof a.result[0].result){g="categorical",j={records:"result",select:[]};for(var k in a.result[0])if(a.result[0].hasOwnProperty(k)&&"result"!==k){j.select.push({path:k,type:"string"});break}j.select.push({path:"result",type:"number"})}if(a.result[0].value instanceof Array){g="cat-chronological",j={records:"result",unpack:{index:{path:d,type:"date"},value:{path:"value -> result",type:"number"}}};for(var k in a.result[0].value[0])if(a.result[0].value[0].hasOwnProperty(k)&&"result"!==k){j.unpack.label={path:"value -> "+k,type:"string"};break}}"number"==typeof a.result[0]&&(g="cat-ordinal",j={records:"",unpack:{index:{path:"steps -> event_collection",type:"string"},value:{path:"result -> ",type:"number"}}})}return h=new Keen.Dataset(a,j),_runLabelMapping.call(i),_runLabelReplacement.call(i),i.dataType(g),h}function _parseRequest(a){var b;return this.dataType(_getQueryDataType.call(this,a.queries[0])),b="extraction"!==this.dataType()?_parseRawData.call(this,a.data instanceof Array?a.data[0]:a.data):_parseExtraction.call(this,a)}function _parseExtraction(a){var b=a.queries[0].get("property_names"),c={records:"result",select:!0};return b&&(c.select=[],_each(b,function(a){c.select.push({path:a})})),new Keen.Dataset(a.data[0],c)}function _getDefaultTitle(a){var b,c=a.queries[0].analysis.replace("_"," "),d=a.queries[0].get("event_collection");return b=c.replace(/\b./g,function(a){return a.toUpperCase()}),d&&(b+=" - "+d),b}function _getQueryDataType(a){var b,c="string"==typeof a.params.interval,d="string"==typeof a.params.group_by,e=a.params.group_by instanceof Array;return d||c||(b="singular"),d&&!c&&(b="categorical"),c&&!d&&(b="chronological"),c&&d&&(b="cat-chronological"),!c&&e&&(b="categorical"),c&&e&&(b="cat-chronological"),"funnel"===a.analysis&&(b="cat-ordinal"),"extraction"===a.analysis&&(b="extraction"),"select_unique"===a.analysis&&(b="nominal"),b}function _runSortGroups(){var a=this.dataType();this.sortGroups()&&(a&&a.indexOf("chronological")>-1||this.data()[0].length>2?this.dataset.sortColumns(this.sortGroups(),this.dataset.getColumnSum):a&&(a.indexOf("cat-")>-1||a.indexOf("categorical")>-1)&&this.dataset.sortRows(this.sortGroups(),this.dataset.getRowSum))}function _runSortIntervals(){this.sortIntervals()&&this.dataset.sortRows(this.sortIntervals())}function _loadScript(a,b){var c,d=document,e=d.head||d.getElementsByTagName("head");setTimeout(function(){if("item"in e){if(!e[0])return void setTimeout(arguments.callee,25);e=e[0]}var c=d.createElement("script"),f=!1;c.onload=c.onreadystatechange=function(){return c.readyState&&"complete"!==c.readyState&&"loaded"!==c.readyState||f?!1:(c.onload=c.onreadystatechange=null,f=!0,void b())},c.src=a,e.insertBefore(c,e.firstChild)},0),null===d.readyState&&d.addEventListener&&(d.readyState="loading",d.addEventListener("DOMContentLoaded",c=function(){d.removeEventListener("DOMContentLoaded",c,!1),d.readyState="complete"},!1))}function _loadStyle(a,b){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.type="text/css",c.href=a,b(),document.head.appendChild(c)}function _prettyNumber(a){function b(a,c){var a=String(a),d=a.split(".");if(d.length>1){a=d[0];var e=d[1];2==a.length&&e.length>0?e.length>0?a=a+"."+e.charAt(0):a+="0":1==a.length&&e.length>0&&(a=a+"."+e.charAt(0),a+=e.length>1?e.charAt(1):"0")}var g=a.length;return a.split(".").length>1&&g--,3>=g?String(a)+f[c]:b(Number(a)/1e3,c+1)}var c=Number(a),d=c.toPrecision(3),e="",f=["","k","M","B","T"];return Number(d)==c&&String(c).length<=4?String(c):c>=1||-1>=c?(0>c&&(c=-c,e="-"),e+b(c,0)):c.toPrecision(3)}Keen.version="3.1.0-beta",Keen.utils={},Keen.canXHR=!1,("object"==typeof XMLHttpRequest||"function"==typeof XMLHttpRequest)&&"withCredentials"in new XMLHttpRequest&&(Keen.canXHR=!0),Keen.urlMaxLength=16e3,(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(Keen.urlMaxLength=2e3),Keen.loaded=!0,Keen.ready=function(a){Keen.loaded?a():Keen.on("ready",a)},Keen.log=function(a){"object"==typeof console&&console.log("[Keen IO]",a)};var Events=Keen.Events={on:function(a,b){this.listeners||(this.listeners={});var c=this.listeners[a]||(this.listeners[a]=[]);return c.push({callback:b}),this},once:function(a,b,c){var d=this,e=_once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,d.on(a,e,c)},off:function(a,b,c){if(!this.listeners)return this;if(!a&&!b&&!c)return this.listeners=void 0,this;var d=[];a?d.push(a):_each(this.listeners,function(a,b){d.push(b)});for(var e=0,f=d.length;f>e;e++){a=d[e];var g=this.listeners[a];if(g)if(b||c){for(var h=[],i=0,j=g.length;j>i;i++){var k=g[i];(b&&b!==k.callback&&b!==k.callback._callback||c&&c!==k.context)&&h.push(k)}h.length?this.listeners[a]=h:delete this.listeners[a]}else delete this.listeners[a]}return this},trigger:function(a){if(!this.listeners)return this;for(var b=Array.prototype.slice.call(arguments,1),c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].callback.apply(this,b);return this}};_extend(Keen.prototype,Events),_extend(Keen,Events);var loaded=window.Keen,cached=window._Keen||{},clients,ready;if(loaded&&cached){clients=cached.clients||{},ready=cached.ready||[];for(var instance in clients)if(clients.hasOwnProperty(instance)){var client=clients[instance];for(var method in Keen.prototype)Keen.prototype.hasOwnProperty(method)&&(loaded.prototype[method]=Keen.prototype[method]);if(loaded.Query=Keen.Query?Keen.Query:function(){},loaded.Visualization=Keen.Visualization?Keen.Visualization:function(){},client._config&&(client.configure.call(client,client._config),delete client._config),client._setGlobalProperties){for(var globals=client._setGlobalProperties,i=0;i<globals.length;i++)client.setGlobalProperties.apply(client,globals[i]);delete client._setGlobalProperties}if(client._addEvent){for(var queue=client._addEvent||[],i=0;i<queue.length;i++)client.addEvent.apply(client,queue[i]);delete client._addEvent}var callback=client._on||[];if(client._on){for(var i=0;i<callback.length;i++)client.on.apply(client,callback[i]);client.trigger("ready"),delete client._on}}for(var i=0;i<ready.length;i++){var callback=ready[i];Keen.once("ready",function(){callback()})}}return Keen.prototype.addEvent=function(){_uploadEvent.apply(this,arguments)},Keen.prototype.masterKey=function(a){return arguments.length?(this.config.masterKey=a?String(a):null,this):this.config.masterKey},Keen.prototype.projectId=function(a){return arguments.length?(this.config.projectId=a?String(a):null,this):this.config.projectId},Keen.prototype.readKey=function(a){return arguments.length?(this.config.readKey=a?String(a):null,this):this.config.readKey},Keen.prototype.setGlobalProperties=function(a){a&&"function"==typeof a?this.config.globalProperties=a:Keen.log("Invalid value for global properties: "+a)},Keen.prototype.trackExternalLink=function(a,b,c,d,e){var f,g,h=a,i=h.currentTarget?h.currentTarget:h.srcElement||h.target,j=d||500,k=!1,l="";return void 0!==i.getAttribute?l=i.getAttribute("target"):i.target&&(l=i.target),"_blank"!=l&&"blank"!=l||h.metaKey||(g=window.open("about:blank"),g.document.location=i.href),"A"===i.nodeName?f=function(){k||h.metaKey||"_blank"===l||"blank"===l||(k=!0,window.location=i.href)}:"FORM"===i.nodeName?f=function(){k||(k=!0,i.submit())}:Keen.log("#trackExternalLink method not attached to an <a> or <form> DOM element"),e&&(f=function(){k||(k=!0,e())}),_uploadEvent.call(this,b,c,f,f),setTimeout(f,j),h.metaKey?void 0:!1},Keen.prototype.url=function(a){return this.config.protocol+"://"+this.config.host+a},Keen.prototype.writeKey=function(a){return arguments.length?(this.config.writeKey=a?String(a):null,this):this.config.writeKey},_extend(Keen.utils,{each:_each}),_extend(Keen.utils,{extend:_extend}),_extend(Keen.utils,{parseParams:_parseParams}),Keen.prototype.run=function(a,b,c){var d=[],e=b,f=c;b=null,c=null,a instanceof Array?d=a:d.push(a);var g=new Keen.Request(this,d,e,f);return e=f=null,g},Keen.Request=function(a,b,c,d){var e=c,f=d;c=null,d=null,this.configure(a,b,e,f),e=f=null},_extend(Keen.Request.prototype,Events),Keen.Request.prototype.configure=function(a,b,c,d){return this.instance=a,this.queries=b,this.data,this.success=c,c=null,this.error=d,d=null,this.refresh(),this},Keen.Request.prototype.refresh=function(){var a=this,b=0,c=[],d=function(d,e){c[e]=d,a.queries[e].data=d,a.queries[e].trigger("complete",a.queries[e].data),b++,b==a.queries.length&&(a.data=1==a.queries.length?c[0]:c,a.trigger("complete",a.data),a.success&&a.success(a.data))},e=function(b,c){var d=JSON.parse(b.responseText);a.trigger("error",d),a.error&&a.error(b,c),Keen.log(b.statusText+" ("+d.error_code+"): "+d.message)};return _each(a.queries,function(b,c){var f,g=function(a){d(a,c)},h=function(a){e(a,c)};if(b instanceof Keen.Query)f=a.instance.url("/projects/"+a.instance.projectId()+b.path),_sendQuery.call(a.instance,f,b.params,g,h);else if("[object String]"===Object.prototype.toString.call(b))f=a.instance.url("/projects/"+a.instance.projectId()+"/saved_queries/"+encodeURIComponent(b)+"/result"),_sendQuery.call(a.instance,f,null,g,h);else{var i={statusText:"Bad Request",responseText:{message:"Error: Query "+(+c+1)+" of "+a.queries.length+" for project "+a.instance.projectId()+" is not a valid request"}};Keen.log(i.responseText.message),Keen.log("Check out our JavaScript SDK Usage Guide for Data Analysis:"),Keen.log("https://keen.io/docs/clients/javascript/usage-guide/#analyze-and-visualize"),a.error&&a.error(i.responseText.message)}}),this},Keen.Query=function(){this.configure.apply(this,arguments)},_extend(Keen.Query.prototype,Events),Keen.Query.prototype.configure=function(a,b){return this.analysis=a,this.path="/queries/"+a,this.params=this.params||{},this.set(b),void 0===this.params.timezone&&(this.params.timezone=_getTimezoneOffset()),this},Keen.Query.prototype.get=function(a){var b=a;return b.match(new RegExp("[A-Z]"))&&(b=b.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})),this.params?this.params[b]||null:void 0},Keen.Query.prototype.set=function(a){var b=this;return _each(a,function(a,c){var d=c,e=a;c.match(new RegExp("[A-Z]"))&&(d=c.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})),b.params[d]=e,e instanceof Array&&_each(e,function(a,c){a instanceof Array==0&&"object"==typeof a&&_each(a,function(a,e){if(e.match(new RegExp("[A-Z]"))){var f=e.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()});delete b.params[d][c][e],b.params[d][c][f]=a}})})}),b},Keen.Query.prototype.addFilter=function(a,b,c){return this.params.filters=this.params.filters||[],this.params.filters.push({property_name:a,operator:b,property_value:c}),this},Keen.Base64={map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map;for(a=this.utf8.encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=isNaN(c)?64:(15&c)<<2|d>>6,h=isNaN(c)||isNaN(d)?64:63&d,i=i+k.charAt(e)+k.charAt(f)+k.charAt(g)+k.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map,l=String.fromCharCode;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)b=k.indexOf(a.charAt(j++)),c=k.indexOf(a.charAt(j++)),d=k.indexOf(a.charAt(j++)),e=k.indexOf(a.charAt(j++)),f=b<<2|c>>4,g=(15&c)<<4|d>>2,h=(3&d)<<6|e,i=i+(l(f)+(64!=d?l(g):""))+(64!=e?l(h):"");return this.utf8.decode(i)},utf8:{encode:function(a){for(var b,c="",d=0,e=String.fromCharCode;d<a.length;)b=a.charCodeAt(d++),c+=128>b?e(b):b>127&&2048>b?e(b>>6|192)+e(63&b|128):e(b>>12|224)+e(b>>6&63|128)+e(63&b|128);return c},decode:function(a){for(var b,c,d="",e=0,f=String.fromCharCode;e<a.length;)c=a.charCodeAt(e),d+=128>c?[f(c),e++][0]:c>191&&224>c?[f((31&c)<<6|63&(b=a.charCodeAt(e+1))),e+=2][0]:[f((15&c)<<12|(63&(b=a.charCodeAt(e+1)))<<6|63&(c3=a.charCodeAt(e+2))),e+=3][0];return d}}},"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b){a.utils.domready=b()}(Keen,function(a){function b(a){for(n=1;a=d.shift();)a()}var c,d=[],e=!1,f=document,g=f.documentElement,h=g.doScroll,i="DOMContentLoaded",j="addEventListener",k="onreadystatechange",l="readyState",m=h?/^loaded|^c/:/^loaded|c/,n=m.test(f[l]);return f[j]&&f[j](i,c=function(){f.removeEventListener(i,c,e),b()},e),h&&f.attachEvent(k,c=function(){/^c/.test(f[l])&&(f.detachEvent(k,c),b())}),a=h?function(b){self!=top?n?b():d.push(b):function(){try{g.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){n?a():d.push(a)}}),function(a,b){a.Spinner=b()}(Keen,function(){function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),Keen.Dataset=function(){this.data={input:{},output:[[]]},this.meta={schema:{},method:void 0},arguments.length>0&&this.parse.apply(this,arguments)},Keen.Dataset.defaults={delimeter:" -> "},Keen.Dataset.prototype.input=function(a){return arguments.length?(this.data.input=a?JSON.parse(JSON.stringify(a)):null,this):this.data.input},Keen.Dataset.prototype.output=function(a){return arguments.length?(this.data.output=a instanceof Array?a:null,this):this.data.output},Keen.Dataset.prototype.method=function(a){return arguments.length?(this.meta.method=a?String(a):null,this):this.meta.method},Keen.Dataset.prototype.schema=function(a){return arguments.length?(this.meta.schema=a?a:null,this):this.meta.schema},Keen.Dataset.prototype.parse=function(a,b){var c;return a&&this.input(a),b&&this.schema(b),this.output([[]]),this.meta.schema.select?(this.method("select"),c=extend({records:"",select:!0},this.schema()),_select.call(this,_optHash(c))):this.meta.schema.unpack&&(this.method("unpack"),c=extend({records:"",unpack:{index:!1,value:!1,label:!1}},this.schema()),_unpack.call(this,_optHash(c))),this},Keen.Dataset.prototype.appendColumn=function(a,b){var c=this,d=(Array.prototype.slice.call(arguments,2),void 0!==a?a:null);return"function"==typeof b?(c.data.output[0].push(d),each(c.output(),function(a,d){var e;d>0&&(e=b.call(c,a,d),"undefined"==typeof e&&(e=null),c.data.output[d].push(e))})):(!b||b instanceof Array)&&(c.data.output[0].push(d),each(c.output(),function(a,d){var e;d>0&&(e=b&&void 0!==b[d-1]?b[d-1]:null,c.data.output[d].push(e))
})),c},Keen.Dataset.prototype.appendRow=function(a,b){var c=this,d=(Array.prototype.slice.call(arguments,2),void 0!==a?a:null),e=[];return e.push(d),"function"==typeof b?(each(c.output()[0],function(a,d){var f,g;d>0&&(f=c.selectColumn(d),g=b.call(c,f,d),"undefined"==typeof g&&(g=null),e.push(g))}),c.data.output.push(e)):(!b||b instanceof Array)&&(each(c.output()[0],function(a,c){var d;c>0&&(d=b&&void 0!==b[c-1]?b[c-1]:null,e.push(d))}),this.data.output.push(e)),this},Keen.Dataset.prototype.filterColumns=function(a){var b=this,c=new Array;return each(b.data.output,function(){c.push([])}),each(b.data.output[0],function(d,e){var f=b.selectColumn(e);(0==e||a.call(b,f,e))&&each(f,function(a,b){c[b].push(a)})}),b.output(c),b},Keen.Dataset.prototype.filterRows=function(a){var b=this,c=[];return each(b.data.output,function(d,e){(0==e||a.call(b,d,e))&&c.push(d)}),b.output(c),b},Keen.Dataset.prototype.format=function(a){var b=this;return"select"===this.method()&&each(b.output(),function(c,d){0==d?each(c,function(c,e){a[e]&&a[e].label&&(b.data.output[d][e]=a[e].label)}):each(c,function(c,e){b.data.output[d][e]=_applyFormat(b.data.output[d][e],a[e])})}),"unpack"===this.method()&&(a.index&&each(b.output(),function(c,d){0==d?a.index.label&&(b.data.output[d][0]=a.index.label):b.data.output[d][0]=_applyFormat(b.data.output[d][0],a.index)}),a.label&&(a.index?each(b.output(),function(c,d){each(c,function(c,e){0==d&&e>0&&(b.data.output[d][e]=_applyFormat(b.data.output[d][e],a.label))})}):each(b.output(),function(c,d){d>0&&(b.data.output[d][0]=_applyFormat(b.data.output[d][0],a.label))})),a.value&&(a.index?each(b.output(),function(c,d){each(c,function(c,e){d>0&&e>0&&(b.data.output[d][e]=_applyFormat(b.data.output[d][e],a.value))})}):each(b.output(),function(c,d){each(c,function(c,e){d>0&&(b.data.output[d][e]=_applyFormat(b.data.output[d][e],a.value))})}))),b},Keen.Dataset.prototype.pick=function(a,b){return a[b]},Keen.Dataset.prototype.getColumnLabel=function(a){return this.pick(a,0)},Keen.Dataset.prototype.getRowIndex=function(a){return this.pick(a,0)},Keen.Dataset.prototype.sum=function(a,b,c){var d=a.slice(b||0,c?c+1:a.length),e=0;return each(d,function(a){"number"!=typeof a||isNaN(parseFloat(a))||(e+=parseFloat(a))}),e},Keen.Dataset.prototype.getColumnSum=function(a){return this.sum(a,1)},Keen.Dataset.prototype.getRowSum=function(a){return this.sum(a,1)},Keen.Dataset.prototype.insertColumn=function(a,b,c){var d,e=this;return d=void 0!==b?b:null,"function"==typeof c?(e.data.output[0].splice(a,0,d),each(e.output(),function(b,d){var f;d>0&&(f=c.call(e,b,d),"undefined"==typeof f&&(f=null),e.data.output[d].splice(a,0,f))})):(!c||c instanceof Array)&&(e.data.output[0].splice(a,0,d),each(e.output(),function(b,d){var f;d>0&&(f=c&&"undefined"!==c[d-1]?c[d-1]:null,e.data.output[d].splice(a,0,f))})),e},Keen.Dataset.prototype.insertRow=function(a,b,c){var d,e=this,f=[];return d=void 0!==b?b:null,f.push(d),"function"==typeof c?(each(e.output()[0],function(a,b){var d,g;b>0&&(d=e.selectColumn(b),g=c.call(e,d,b),"undefined"==typeof g&&(g=null),f.push(g))}),e.data.output.splice(a,0,f)):(!c||c instanceof Array)&&(each(e.output()[0],function(a,b){var d;b>0&&(d=c&&void 0!==c[b-1]?c[b-1]:null,f.push(d))}),this.data.output.splice(a,0,f)),this},Keen.Dataset.prototype.deleteColumn=function(a){var b=this,c=isNaN(parseInt(a))?this.output()[0].indexOf(a):a;return c>-1&&each(b.data.output,function(a,d){b.data.output[d].splice(c,1)}),b},Keen.Dataset.prototype.deleteRow=function(a){var b=isNaN(parseInt(a))?this.selectColumn(0).indexOf(a):a;return b>-1&&this.data.output.splice(b,1),this},Keen.Dataset.prototype.selectColumn=function(a){var b=new Array,c=isNaN(parseInt(a))?this.output()[0].indexOf(a):a;return c>-1&&each(this.data.output,function(a){b.push(a[c])}),b},Keen.Dataset.prototype.selectRow=function(a){var b=isNaN(parseInt(a))?this.selectColumn(0).indexOf(a):a;return b>-1?this.data.output[b]:void 0},Keen.Dataset.prototype.sortColumns=function(a,b){var c=this,d=this.output()[0].slice(1),e=[],f=b||this.getColumnLabel;return each(d,function(a,b){e.push(c.selectColumn(b+1).slice(0))}),e.sort(function(b,d){var e=f.call(c,b)>f.call(c,d);return e?"asc"===a?1:-1:e?0:"asc"===a?-1:1}),each(e,function(a,b){c.deleteColumn(b+1).insertColumn(b+1,a[0],a.slice(1))}),c},Keen.Dataset.prototype.sortRows=function(a,b){var c=this,d=this.output().slice(0,1),e=this.output().slice(1),f=b||this.getRowIndex;return e.sort(function(b,d){var e=f.call(c,b)>f.call(c,d);return e?"asc"===a?1:-1:e?0:"asc"===a?-1:1}),c.output(d.concat(e)),c},Keen.Dataset.prototype.updateColumn=function(a,b){var c,d=this;return c=isNaN(parseInt(a))?this.output()[0].indexOf(a):a,c>-1&&("function"==typeof b?each(d.output(),function(a,e){var f;e>0&&(f=b.call(d,a[c],e,a),"undefined"!=typeof f&&(d.data.output[e][c]=f))}):(!b||b instanceof Array)&&each(d.output(),function(a,e){var f;e>0&&(f=b&&"undefined"!=typeof b[e-1]?b[e-1]:null,d.data.output[e][c]=f)})),d},Keen.Dataset.prototype.updateRow=function(a,b){var c,d=this;return c=isNaN(parseInt(a))?this.selectColumn(0).indexOf(a):a,c>-1&&("function"==typeof b?each(d.output()[c],function(a,e){var f=d.selectColumn(e),g=b.call(d,a,e,f);"undefined"!=typeof g&&(d.data.output[c][e]=g)}):(!b||b instanceof Array)&&each(d.output()[c],function(a,e){var f;e>0&&(f=b&&void 0!==b[e-1]?b[e-1]:null,d.data.output[c][e]=f)})),d},_extend(Keen.utils,{prettyNumber:_prettyNumber,loadScript:_loadScript,loadStyle:_loadStyle}),Keen.loaded=!1,Keen.Dataviz=function(){this.dataset=new Keen.Dataset,this.view={_prepared:!1,_initialized:!1,_rendered:!1,_artifacts:{},adapter:{library:void 0,chartType:void 0,defaultChartType:void 0,dataType:void 0},attributes:JSON.parse(JSON.stringify(Keen.Dataviz.defaults)),defaults:JSON.parse(JSON.stringify(Keen.Dataviz.defaults)),el:void 0,loader:{library:"keen-io",chartType:"spinner"}},Keen.Dataviz.visuals.push(this)},_extend(Keen.Dataviz.prototype,Events),_extend(Keen.Dataviz,{dataTypeMap:{singular:{library:"keen-io",chartType:"metric"},categorical:{library:"google",chartType:"piechart"},"cat-interval":{library:"google",chartType:"columnchart"},"cat-ordinal":{library:"google",chartType:"barchart"},chronological:{library:"google",chartType:"areachart"},"cat-chronological":{library:"google",chartType:"linechart"}},defaults:{colors:["#00bbde","#fe6672","#eeb058","#8a8ad6","#ff855c","#00cfbb","#5a9eed","#73d483","#c879bb","#0099b6","#d74d58","#cb9141","#6b6bb6","#d86945","#00aa99","#4281c9","#57b566","#ac5c9e","#27cceb","#ff818b","#f6bf71","#9b9be1","#ff9b79","#26dfcd","#73aff4","#87e096","#d88bcb"],indexBy:"timeframe.start"},dependencies:{loading:0,loaded:0,urls:{}},libraries:{},visuals:[]}),Keen.Dataviz.register=function(a,b,c){var d=this,e=function(a){a.loaded++,a.loaded===a.loading&&(Keen.loaded=!0,Keen.trigger("ready"))};Keen.Dataviz.libraries[a]=Keen.Dataviz.libraries[a]||{},_each(b,function(b,c){Keen.Dataviz.libraries[a][c]=b}),c&&c.capabilities&&(Keen.Dataviz.libraries[a]._defaults=Keen.Dataviz.libraries[a]._defaults||{},_each(c.capabilities,function(b,c){Keen.Dataviz.libraries[a]._defaults[c]=b})),c&&c.dependencies&&_each(c.dependencies,function(a){var b=Keen.Dataviz.dependencies;if(!b.urls[a.url]){b.urls[a.url]=!0,b.loading++;var c="script"===a.type?_loadScript:_loadStyle;c(a.url,function(){a.cb?a.cb.call(d,function(){e(b)}):e(b)})}})},Keen.Dataviz.find=function(a){if(!arguments.length)return Keen.Dataviz.visuals;var b,c=a.nodeName?a:document.querySelector(a);return _each(Keen.Dataviz.visuals,function(a){return c==a.el()?(b=a,!1):void 0}),b?b:void 0},function(a){function b(a){var b={bindto:this.el(),data:{columns:[]},color:{pattern:this.colors()},size:{height:this.height(),width:this.width()}};return b.data.type=a,"gauge"===a||("pie"===a||"donut"===a?b[a]={title:this.title()}:this.dataType().indexOf("chron")>-1&&(b.data.x="x",b.axis={x:{type:"timeseries",tick:{format:"%Y-%m-%d"}}})),d.utils.extend(b,this.chartOptions())}function c(){this.view._artifacts.c3&&(this.view._artifacts.c3.destroy(),this.view._artifacts.c3=null)}var d=a||{},e={singular:["gauge"],categorical:["donut","pie"],"cat-interval":["area-step","step","bar","area","area-spline","spline","line"],"cat-ordinal":["bar","area","area-spline","spline","line","step","area-step"],chronological:["area","area-spline","spline","line","bar","step","area-step"],"cat-chronological":["line","spline","area","area-spline","bar","step","area-step"]},f={};d.utils.each(["gauge","donut","pie","bar","area","area-spline","spline","line","step","area-step"],function(a){f[a]={render:function(){var c=b.call(this,a);this.view._artifacts.c3=c3.generate(c),this.update()},update:function(){var b=this,c=[];"gauge"===a?b.view._artifacts.c3.load({columns:[[b.title(),b.data()[1][1]]]}):"pie"===a||"donut"===a?b.view._artifacts.c3.load({columns:b.dataset.data.output.slice(1)}):(this.dataType().indexOf("chron")>-1&&(c.push(b.dataset.selectColumn(0)),c[0][0]="x"),d.utils.each(b.data()[0],function(a,d){d>0&&c.push(b.dataset.selectColumn(d))}),b.view._artifacts.c3.groups([b.data()[0].slice(1)]),b.view._artifacts.c3.load({columns:c}))},destroy:function(){c.call(this)}}}),d.Dataviz.register("c3",f,{capabilities:e})}(Keen),function(a){function b(){var a=this,b=[];return i.utils.each(a.dataset.selectColumn(0).slice(1),function(c,d){b.push({value:a.dataset.selectColumn(1).slice(1)[d],color:a.colors()[+d],hightlight:a.colors()[+d+9],label:c})}),b}function c(){var a,b=this,c={labels:[],datasets:[]};return a=this.dataset.selectColumn(0).slice(1),i.utils.each(a,function(a){c.labels.push(a instanceof Date?a.getMonth()+1+"-"+a.getDate()+"-"+a.getFullYear():a)}),i.utils.each(b.dataset.selectRow(0).slice(1),function(a,d){var h={r:e(b.colors()[d]),g:f(b.colors()[d]),b:g(b.colors()[d])};c.datasets.push({label:a,fillColor:"rgba("+h.r+","+h.g+","+h.b+",0.2)",strokeColor:"rgba("+h.r+","+h.g+","+h.b+",1)",pointColor:"rgba("+h.r+","+h.g+","+h.b+",1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba("+h.r+","+h.g+","+h.b+",1)",data:b.dataset.selectColumn(+d+1).slice(1)})}),c}function d(){this.view._artifacts.chartjs&&(this.view._artifacts.chartjs.destroy(),this.view._artifacts.chartjs=null)}function e(a){return parseInt(h(a).substring(0,2),16)}function f(a){return parseInt(h(a).substring(2,4),16)}function g(a){return parseInt(h(a).substring(4,6),16)}function h(a){return"#"==a.charAt(0)?a.substring(1,7):a}var i=a||{};"undefined"!=typeof Chart&&(Chart.defaults.global.responsive=!0);var j={categorical:["doughnut","pie","polar-area","radar"],"cat-interval":["bar","line"],"cat-ordinal":["bar","line"],chronological:["line","bar"],"cat-chronological":["line","bar"]},k={radar:"Radar","polar-area":"PolarArea",pie:"Pie",doughnut:"Doughnut",line:"Line",bar:"Bar"},l={doughnut:b,pie:b,"polar-area":b,radar:c,line:c,bar:c},m={};i.utils.each(["doughnut","pie","polar-area","radar","bar","line"],function(a){m[a]={initialize:function(){if("canvas"!==this.el().nodeName.toLowerCase()){var a=document.createElement("canvas");this.el().innerHTML="",this.el().appendChild(a),this.view._artifacts.ctx=a.getContext("2d")}else this.view._artifacts.ctx=this.el().getContext("2d");return this},render:function(){var b=k[a],c=_extend({},this.chartOptions()),d=l[a].call(this);return this.view._artifacts.chartjs&&this.view._artifacts.chartjs.destroy(),this.view._artifacts.chartjs=new Chart(this.view._artifacts.ctx)[b](d,c),this},destroy:function(){d.call(this)}}}),i.Dataviz.register("chartjs",m,{capabilities:j})}(Keen),function(a){function b(a){var b=e[a.id]||a.message||"An error occurred";this.error(b)}function c(a){var b={};switch(a.toLowerCase()){case"areachart":b.lineWidth=2,b.hAxis={baselineColor:"transparent",gridlines:{color:"transparent"}},b.vAxis={viewWindow:{min:0}},"chronological"===this.dataType()&&(b.legend={position:"none"},b.chartArea={width:"85%"});break;case"barchart":b.hAxis={viewWindow:{min:0}},b.vAxis={baselineColor:"transparent",gridlines:{color:"transparent"}},"chronological"===this.dataType()&&(b.legend={position:"none"});break;case"columnchart":b.hAxis={baselineColor:"transparent",gridlines:{color:"transparent"}},b.vAxis={viewWindow:{min:0}},"chronological"===this.dataType()&&(b.legend={position:"none"},b.chartArea={width:"85%"});break;case"linechart":b.lineWidth=2,b.hAxis={baselineColor:"transparent",gridlines:{color:"transparent"}},b.vAxis={viewWindow:{min:0}},"chronological"===this.dataType()&&(b.legend={position:"none"},b.chartArea={width:"85%"});break;case"piechart":b.sliceVisibilityThreshold=.01;break;case"table":}return b}var d=a||{},e={"google-visualization-errors-0":"No results to visualize"},f=["AreaChart","BarChart","ColumnChart","LineChart","PieChart","Table"],g={},h={categorical:["piechart","barchart","columnchart","table"],"cat-interval":["columnchart","barchart","table"],"cat-ordinal":["barchart","columnchart","areachart","linechart","table"],chronological:["areachart","linechart","table"],"cat-chronological":["linechart","columnchart","barchart","areachart"],nominal:["table"],extraction:["table"]};d.utils.each(f,function(a){var e=a.toLowerCase();g[e]={initialize:function(){},render:function(){var c=this;c.view._artifacts.googlechart&&this.destroy(),c.view._artifacts.googlechart=c.view._artifacts.googlechart||new google.visualization[a](c.el()),google.visualization.events.addListener(c.view._artifacts.googlechart,"error",function(a){b.call(c,a)}),this.update()},update:function(){var b=c.call(this,a);d.utils.extend(b,this.chartOptions(),this.attributes()),this.view._artifacts.datatable=google.visualization.arrayToDataTable(this.data()),this.view._artifacts.googlechart&&this.view._artifacts.googlechart.draw(this.view._artifacts.datatable,b)},destroy:function(){this.view._artifacts.googlechart&&(google.visualization.events.removeAllListeners(this.view._artifacts.googlechart),this.view._artifacts.googlechart.clearChart(),this.view._artifacts.googlechart=null,this.view._artifacts.datatable=null)}}}),d.Dataviz.register("google",g,{capabilities:h,dependencies:[{type:"script",url:"https://www.google.com/jsapi",cb:function(a){if("undefined"==typeof google)throw new Error("Problem loading Google Charts library. Please contact us!");google.load("visualization","1.1",{packages:["corechart","table"],callback:function(){a()}})}}]})}(Keen),function(a){var b,c,d,e=a||{};e.Error={defaults:{backgroundColor:"",borderRadius:"4px",color:"#ccc",display:"block",fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"21px",fontWeight:"light",textAlign:"center"}},e.Spinner.defaults={lines:10,length:8,width:3,radius:10,corners:1,rotate:0,direction:1,color:"#4d4d4d",speed:1.67,trail:60,shadow:!1,hwaccel:!1,className:"keen-spinner",zIndex:2e9,top:"50%",left:"50%"};var f={singular:["metric"]};b={initialize:function(){var a=document.createElement("style"),b="#49c5b1";a.id="keen-widgets",a.type="text/css",a.innerHTML="    .keen-metric { \n  background: "+b+"; \n  border-radius: 4px; \n  color: #fff; \n  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; \n  padding: 10px 0; \n  text-align: center; \n}     .keen-metric-value { \n  display: block; \n  font-size: 84px; \n  font-weight: 700; \n  line-height: 84px; \n}     .keen-metric-title { \n  display: block; \n  font-size: 24px; \n  font-weight: 200; \n}",document.getElementById(a.id)||document.body.appendChild(a)},render:function(){var a=1==this.colors().length?this.colors()[0]:"#49c5b1",b="",c="",d=this.title()||"Result",f=this.data()[1][1]||0,g=this.width(),h=this.chartOptions()||{};("undefined"==typeof h.prettyNumber||1==h.prettyNumber)&&(f=e.utils.prettyNumber(f)),h.prefix&&(b='<span class="keen-metric-prefix">'+h.prefix+"</span>"),h.suffix&&(c='<span class="keen-metric-suffix">'+h.suffix+"</span>"),this.el().innerHTML='<div class="keen-widget keen-metric" style="background-color: '+a+"; width:"+g+'px;"><span class="keen-metric-value">'+b+f+c+'</span><span class="keen-metric-title">'+d+"</span></div>"}},c={initialize:function(){},render:function(a,b){var c,d,f=JSON.parse(JSON.stringify(e.Error.defaults)),g=_extend(f,b);c=document.createElement("div"),c.className="keen-error",_each(g,function(a,b){c.style[b]=a}),c.style.height=String(this.height()+"px"),c.style.paddingTop=this.height()/2-15+"px",c.style.width=String(this.width()+"px"),d=document.createElement("span"),d.innerHTML=a||"Yikes! An error occurred!",c.appendChild(d),this.el().innerHTML="",this.el().appendChild(c)},destroy:function(){this.el().innerHTML=""}},d={initialize:function(){},render:function(){var a=document.createElement("div");a.className="keen-loading",a.style.height=String(this.height()+"px"),a.style.position="relative",a.style.width=String(this.width()+"px"),this.el().innerHTML="",this.el().appendChild(a),this.view._artifacts.spinner=new e.Spinner(e.Spinner.defaults).spin(a)},destroy:function(){this.view._artifacts.spinner.stop(),this.view._artifacts.spinner=null}},e.Dataviz.register("keen-io",{metric:b,error:c,spinner:d},{capabilities:f})}(Keen),Keen.Dataviz.prototype.destroy=function(){var a=_getAdapterActions.call(this);return a.destroy&&a.destroy.apply(this,arguments),this.el()&&(this.el().innerHTML=""),this.view._prepared=!1,this.view._initialized=!1,this.view._rendered=!1,this.view._artifacts={},this},Keen.Dataviz.prototype.error=function(){var a=_getAdapterActions.call(this);return a.error?a.error.apply(this,arguments):Keen.Dataviz.libraries["keen-io"].error.render.apply(this,arguments),this},Keen.Dataviz.prototype.initialize=function(){var a=_getAdapterActions.call(this),b=Keen.Dataviz.libraries[this.view.loader.library][this.view.loader.chartType];return this.view._prepared?b.destroy&&b.destroy.apply(this,arguments):this.el()&&(this.el().innerHTML=""),a.initialize&&a.initialize.apply(this,arguments),this.view._initialized=!0,this},Keen.Dataviz.prototype.render=function(a){var b=_getAdapterActions.call(this);return _applyPostProcessing.call(this),a&&this.el(a),this.view._initialized||this.initialize(),this.el()&&b.render&&b.render.apply(this,arguments),this.view._rendered=!0,this},Keen.Dataviz.prototype.update=function(){var a=_getAdapterActions.call(this);return _applyPostProcessing.call(this),a.update?a.update.apply(this,arguments):a.render&&this.render(),this},Keen.Dataviz.prototype.adapter=function(a){if(!arguments.length)return this.view.adapter;var b=this;return _each(a,function(a,c){b.view.adapter[c]=a?a:null}),this},Keen.Dataviz.prototype.attributes=function(a){if(!arguments.length)return this.view.attributes;var b=this;return _each(a,function(a,c){"chartOptions"===c?b.chartOptions(a):b.view.attributes[c]=a?a:null}),this},Keen.Dataviz.prototype.call=function(a){return a.call(this),this},Keen.Dataviz.prototype.chartOptions=function(a){if(!arguments.length)return this.view.adapter.chartOptions;var b=this;return b.view.adapter.chartOptions=b.view.adapter.chartOptions||{},_each(a,function(a,c){b.view.adapter.chartOptions[c]=a?a:null}),this},Keen.Dataviz.prototype.chartType=function(a){return arguments.length?(this.view.adapter.chartType=a?String(a):null,this):this.view.adapter.chartType},Keen.Dataviz.prototype.colorMapping=function(a){return arguments.length?(this.view.attributes.colorMapping=a?a:null,_runColorMapping.call(this),this):this.view.attributes.colorMapping},Keen.Dataviz.prototype.colors=function(a){return arguments.length?(this.view.attributes.colors=a instanceof Array?a:null,this.view.defaults.colors=a instanceof Array?a:null,this):this.view.attributes.colors},Keen.Dataviz.prototype.data=function(a){return arguments.length?(a instanceof Keen.Dataset?this.dataset=a:a instanceof Keen.Request?this.parseRequest(a):this.parseRawData(a),this):this.dataset.output()},Keen.Dataviz.prototype.dataType=function(a){return arguments.length?(this.view.adapter.dataType=a?String(a):null,this):this.view.adapter.dataType},Keen.Dataviz.prototype.defaultChartType=function(a){return arguments.length?(this.view.adapter.defaultChartType=a?String(a):null,this):this.view.adapter.defaultChartType},Keen.Dataviz.prototype.el=function(a){return arguments.length?(this.view.el=a,this):this.view.el},Keen.Dataviz.prototype.height=function(a){return arguments.length?(this.view.attributes.height=isNaN(parseInt(a))?null:parseInt(a),this):this.view.attributes.height},Keen.Dataviz.prototype.indexBy=function(a){return arguments.length?(this.view.attributes.indexBy=a?String(a):Keen.Dataviz.defaults.indexBy,_runIndexBy.call(this),this):this.view.attributes.indexBy},Keen.Dataviz.prototype.labelMapping=function(a){return arguments.length?(this.view.attributes.labelMapping=a?a:null,_runLabelMapping.call(this),this):this.view.attributes.labelMapping},Keen.Dataviz.prototype.labels=function(a){return arguments.length?(this.view.attributes.labels=a instanceof Array?a:null,_runLabelReplacement.call(this),this):this.view.attributes.labels},Keen.Dataviz.prototype.library=function(a){return arguments.length?(this.view.adapter.library=a?String(a):null,this):this.view.adapter.library},Keen.Dataviz.prototype.parseRawData=function(a){return this.dataset=_parseRawData.call(this,a),this},Keen.Dataviz.prototype.parseRequest=function(a){return this.dataset=_parseRequest.call(this,a),this.view.defaults.title=_getDefaultTitle.call(this,a),this.title()||this.title(this.view.defaults.title),this},Keen.Dataviz.prototype.prepare=function(a){a&&this.el(a),this.view._rendered&&this.destroy(),this.el().innerHTML="";var b=Keen.Dataviz.libraries[this.view.loader.library][this.view.loader.chartType];return b.initialize&&b.initialize.apply(this,arguments),b.render&&b.render.apply(this,arguments),this.view._prepared=!0,this},Keen.Dataviz.prototype.sortGroups=function(a){return arguments.length?(this.view.attributes.sortGroups=a?String(a):null,_runSortGroups.call(this),this):this.view.attributes.sortGroups},Keen.Dataviz.prototype.sortIntervals=function(a){return arguments.length?(this.view.attributes.sortIntervals=a?String(a):null,_runSortIntervals.call(this),this):this.view.attributes.sortIntervals},Keen.Dataviz.prototype.title=function(a){return arguments.length?(this.view.attributes.title=a?String(a):null,this):this.view.attributes.title},Keen.Dataviz.prototype.width=function(a){return arguments.length?(this.view.attributes.width=isNaN(parseInt(a))?null:parseInt(a),this):this.view.attributes.width},Keen.prototype.draw=function(a,b,c){var d=JSON.parse(JSON.stringify(Keen.Visualization.defaults)),e=new Keen.Dataviz,f=new Keen.Request(this,[a]),g=c||{};return g.chartType&&(e.chartType(g.chartType),delete c.chartType),g.library&&(e.library(g.library),delete c.library),g.chartOptions&&(e.chartOptions(g.chartOptions),delete c.chartOptions),e.attributes(_extend(d,g)).prepare(b),f.on("complete",function(){e.parseRequest(this).render()}),f.on("error",function(a){e.error(a.message)}),e},Keen.Request.prototype.draw=function(a,b){return new Keen.Visualization(this,a,b)},Keen.Visualization=function(a,b,c){var d=JSON.parse(JSON.stringify(Keen.Visualization.defaults)),e=(new Keen.Dataviz).data(a).el(b),f=c||{};return f.chartType&&(e.chartType(f.chartType),delete f.chartType),f.library&&(e.library(f.library),delete f.library),f.chartOptions&&(e.chartOptions(f.chartOptions),delete f.chartOptions),e.attributes(_extend(d,f)).render(),e},Keen.Visualization.defaults=_extend({height:400},JSON.parse(JSON.stringify(Keen.Dataviz.defaults))),Keen.loaded&&setTimeout(function(){Keen.utils.domready(function(){Keen.trigger("ready")})},0),Keen});