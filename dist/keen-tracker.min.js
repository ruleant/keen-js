!function(a,b,c){"function"==typeof define&&define.amd&&define("keen",[],function(){return c()}),"object"==typeof module&&"object"==typeof module.exports?module.exports=c():b[a]=c()}("Keen",this,function(Keen){"use strict";function Keen(a){a||Keen.log("Check out our JavaScript SDK Usage Guide: https://github.com/keenlabs/keen-js/tree/master/docs"),a.projectId||Keen.log("Please provide a projectId"),Keen.canXHR||"xhr"!==a.requestType||(a.requestType="jsonp"),a.host&&a.host.replace(/.*?:\/\//g,""),a.protocol&&"auto"===a.protocol&&(a.protocol=location.protocol.replace(/:/g,"")),this.config={projectId:a.projectId,writeKey:a.writeKey,readKey:a.readKey,masterKey:a.masterKey,requestType:a.requestType||"jsonp",host:a.host||"api.keen.io/3.0",protocol:a.protocol||"https",globalProperties:null},this.trigger("ready"),Keen.trigger("client",this,a)}function _once(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}function _each(a,b,c){var d;if(!a)return 0;if(c=c?c:a,a instanceof Array){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function _extend(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])a[c]=arguments[b][c];return a}function _parseParams(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1];b=e.exec(g);)c[f(b[1])]=f(b[2]);return c}function _sendBeacon(a,b,c,d){var e=c,f=d,g=!1,h=document.createElement("img");c=null,d=null,h.onload=function(){if(g=!0,"naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();e&&(e({created:!0}),e=f=null)},h.onerror=function(){g=!0,f&&(f(),e=f=null)},h.src=a+"&c=clv1"}function _sendJsonp(a,b,c,d){var e=(new Date).getTime(),f=c,g=d,h=document.createElement("script"),i=document.getElementsByTagName("head")[0],j="keenJSONPCallback",k="keen-jsonp",l=!1;for(c=null,d=null,j+=e,k+=e;j in window;)j+="a";window[j]=function(a){l=!0,f&&a&&f(a),i.removeChild(h),delete window[j],f=g=null},h.id=k,h.src=a+"&jsonp="+j,i.appendChild(h),h.onreadystatechange=function(){l===!1&&"loaded"===this.readyState&&(l=!0,g&&(g(),f=g=null))},h.onerror=function(){l===!1&&(l=!0,g&&(g(),f=g=null))}}function _sendXhr(a,b,c,d,e,f){var g,h,i=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],j=e,k=f;if(e=null,f=null,window.XMLHttpRequest)h=new XMLHttpRequest;else for(var l=0;l<i.length;l++)try{h=new ActiveXObject(i[l]);break}catch(m){}h.onreadystatechange=function(){var a;if(4==h.readyState)if(h.status>=200&&h.status<300){try{a=JSON.parse(h.responseText)}catch(b){Keen.log("Could not parse HTTP response: "+h.responseText),k&&(k(h,b),j=k=null)}j&&a&&(j(a),j=k=null)}else Keen.log("HTTP request failed."),k&&(k(h,null),j=k=null)},h.open(a,b,!0),_each(c,function(a,b){h.setRequestHeader(b,a)}),d&&(g=JSON.stringify(d)),a&&"GET"===a.toUpperCase()?h.send():a&&"POST"===a.toUpperCase()&&h.send(g)}function _uploadEvent(a,b,c,d){var e=this.url("/projects/"+this.projectId()+"/events/"+a),f="",g=this.config.requestType,h={};return this.config.globalProperties&&(h=this.config.globalProperties(a)),_each(b,function(a,b){h[b]=a}),"xhr"!==g&&(f+="?api_key="+encodeURIComponent(this.writeKey()),f+="&data="+encodeURIComponent(Keen.Base64.encode(JSON.stringify(h))),f+="&modified="+encodeURIComponent((new Date).getTime()),String(e+f).length<Keen.urlMaxLength)?void("jsonp"===g?_sendJsonp(e+f,null,c,d):_sendBeacon(e+f,null,c,d)):void(Keen.canXHR?_sendXhr("POST",e,{Authorization:this.writeKey(),"Content-Type":"application/json"},h,c,d):Keen.log("Event not sent: URL length exceeds current browser limit, and XHR (POST) is not supported."))}Keen.version="3.1.0-beta",Keen.utils={},Keen.canXHR=!1,("object"==typeof XMLHttpRequest||"function"==typeof XMLHttpRequest)&&"withCredentials"in new XMLHttpRequest&&(Keen.canXHR=!0),Keen.urlMaxLength=16e3,(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(Keen.urlMaxLength=2e3),Keen.loaded=!0,Keen.ready=function(a){Keen.loaded?a():Keen.on("ready",a)},Keen.log=function(a){"object"==typeof console&&console.log("[Keen IO]",a)};var Events=Keen.Events={on:function(a,b){this.listeners||(this.listeners={});var c=this.listeners[a]||(this.listeners[a]=[]);return c.push({callback:b}),this},once:function(a,b,c){var d=this,e=_once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,d.on(a,e,c)},off:function(a,b,c){if(!this.listeners)return this;if(!a&&!b&&!c)return this.listeners=void 0,this;var d=[];a?d.push(a):_each(this.listeners,function(a,b){d.push(b)});for(var e=0,f=d.length;f>e;e++){a=d[e];var g=this.listeners[a];if(g)if(b||c){for(var h=[],i=0,j=g.length;j>i;i++){var k=g[i];(b&&b!==k.callback&&b!==k.callback._callback||c&&c!==k.context)&&h.push(k)}h.length?this.listeners[a]=h:delete this.listeners[a]}else delete this.listeners[a]}return this},trigger:function(a){if(!this.listeners)return this;for(var b=Array.prototype.slice.call(arguments,1),c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].callback.apply(this,b);return this}};_extend(Keen.prototype,Events),_extend(Keen,Events);var loaded=window.Keen,cached=window._Keen||{},clients,ready;if(loaded&&cached){clients=cached.clients||{},ready=cached.ready||[];for(var instance in clients)if(clients.hasOwnProperty(instance)){var client=clients[instance];for(var method in Keen.prototype)Keen.prototype.hasOwnProperty(method)&&(loaded.prototype[method]=Keen.prototype[method]);if(loaded.Query=Keen.Query?Keen.Query:function(){},loaded.Visualization=Keen.Visualization?Keen.Visualization:function(){},client._config&&(client.configure.call(client,client._config),delete client._config),client._setGlobalProperties){for(var globals=client._setGlobalProperties,i=0;i<globals.length;i++)client.setGlobalProperties.apply(client,globals[i]);delete client._setGlobalProperties}if(client._addEvent){for(var queue=client._addEvent||[],i=0;i<queue.length;i++)client.addEvent.apply(client,queue[i]);delete client._addEvent}var callback=client._on||[];if(client._on){for(var i=0;i<callback.length;i++)client.on.apply(client,callback[i]);client.trigger("ready"),delete client._on}}for(var i=0;i<ready.length;i++){var callback=ready[i];Keen.once("ready",function(){callback()})}}return Keen.prototype.addEvent=function(){_uploadEvent.apply(this,arguments)},Keen.prototype.masterKey=function(a){return arguments.length?(this.config.masterKey=a?String(a):null,this):this.config.masterKey},Keen.prototype.projectId=function(a){return arguments.length?(this.config.projectId=a?String(a):null,this):this.config.projectId},Keen.prototype.readKey=function(a){return arguments.length?(this.config.readKey=a?String(a):null,this):this.config.readKey},Keen.prototype.setGlobalProperties=function(a){a&&"function"==typeof a?this.config.globalProperties=a:Keen.log("Invalid value for global properties: "+a)},Keen.prototype.trackExternalLink=function(a,b,c,d,e){var f,g,h=a,i=h.currentTarget?h.currentTarget:h.srcElement||h.target,j=d||500,k=!1,l="";return void 0!==i.getAttribute?l=i.getAttribute("target"):i.target&&(l=i.target),"_blank"!=l&&"blank"!=l||h.metaKey||(g=window.open("about:blank"),g.document.location=i.href),"A"===i.nodeName?f=function(){k||h.metaKey||"_blank"===l||"blank"===l||(k=!0,window.location=i.href)}:"FORM"===i.nodeName?f=function(){k||(k=!0,i.submit())}:Keen.log("#trackExternalLink method not attached to an <a> or <form> DOM element"),e&&(f=function(){k||(k=!0,e())}),_uploadEvent.call(this,b,c,f,f),setTimeout(f,j),h.metaKey?void 0:!1},Keen.prototype.url=function(a){return this.config.protocol+"://"+this.config.host+a},Keen.prototype.writeKey=function(a){return arguments.length?(this.config.writeKey=a?String(a):null,this):this.config.writeKey},_extend(Keen.utils,{each:_each}),_extend(Keen.utils,{extend:_extend}),_extend(Keen.utils,{parseParams:_parseParams}),Keen.Base64={map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map;for(a=this.utf8.encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=isNaN(c)?64:(15&c)<<2|d>>6,h=isNaN(c)||isNaN(d)?64:63&d,i=i+k.charAt(e)+k.charAt(f)+k.charAt(g)+k.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0,k=this.map,l=String.fromCharCode;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)b=k.indexOf(a.charAt(j++)),c=k.indexOf(a.charAt(j++)),d=k.indexOf(a.charAt(j++)),e=k.indexOf(a.charAt(j++)),f=b<<2|c>>4,g=(15&c)<<4|d>>2,h=(3&d)<<6|e,i=i+(l(f)+(64!=d?l(g):""))+(64!=e?l(h):"");return this.utf8.decode(i)},utf8:{encode:function(a){for(var b,c="",d=0,e=String.fromCharCode;d<a.length;)b=a.charCodeAt(d++),c+=128>b?e(b):b>127&&2048>b?e(b>>6|192)+e(63&b|128):e(b>>12|224)+e(b>>6&63|128)+e(63&b|128);return c},decode:function(a){for(var b,c,d="",e=0,f=String.fromCharCode;e<a.length;)c=a.charCodeAt(e),d+=128>c?[f(c),e++][0]:c>191&&224>c?[f((31&c)<<6|63&(b=a.charCodeAt(e+1))),e+=2][0]:[f((15&c)<<12|(63&(b=a.charCodeAt(e+1)))<<6|63&(c3=a.charCodeAt(e+2))),e+=3][0];return d}}},"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b){a.utils.domready=b()}(Keen,function(a){function b(a){for(n=1;a=d.shift();)a()}var c,d=[],e=!1,f=document,g=f.documentElement,h=g.doScroll,i="DOMContentLoaded",j="addEventListener",k="onreadystatechange",l="readyState",m=h?/^loaded|^c/:/^loaded|c/,n=m.test(f[l]);return f[j]&&f[j](i,c=function(){f.removeEventListener(i,c,e),b()},e),h&&f.attachEvent(k,c=function(){/^c/.test(f[l])&&(f.detachEvent(k,c),b())}),a=h?function(b){self!=top?n?b():d.push(b):function(){try{g.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){n?a():d.push(a)}}),Keen.loaded&&setTimeout(function(){Keen.utils.domready(function(){Keen.trigger("ready")})},0),Keen});